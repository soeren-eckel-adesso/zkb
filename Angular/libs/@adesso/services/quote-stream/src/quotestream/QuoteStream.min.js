var Smarthouse;(function(n){var t;(function(n){function e(){var r="Smarthouse QuoteStream "+n.version+" (Lightstreamer "+Lightstreamer.LightstreamerClient.LIB_VERSION+")\n",f,o,e,u,s,h,c;if(t==null)r=r.concat("LightstreamerClient is not initialized.");else for(r=r.concat("LightstreamerClient :\n"),f=t.getLightstreamerClient(),r=r.concat("  Status: ",f.getStatus(),"\n"),r=r.concat("  Url: ",f.connectionDetails.getServerAddress(),"\n"),r=r.concat("  User: ",f.connectionDetails.getUser(),"\n"),r=r.concat("  FeedAdapter: ",f.connectionDetails.getAdapterSet(),"\n"),r=r.concat("  Subscriptions:\n"),o=f.getSubscriptions(),e=0;e<o.length;e++)u=o[e],s=u.getListeners(),s.length==1?(h=s[0],r=h instanceof Lightstreamer.StaticGrid?r.concat("    StaticGrid:\n"):h instanceof Lightstreamer.DynaGrid?r.concat("    DynaGrid:\n"):r.concat("    Subscription:\n")):r=r.concat("    Subscription:\n"),r=r.concat("      Is active: "+u.isActive(),"\n"),r=r.concat("      Is subscribed: "+u.isSubscribed(),"\n"),r=r.concat("      Items: "+u.getItems(),"\n"),r=r.concat("      Fields: "+u.getFields(),"\n"),r=r.concat("      Data Adapter: "+u.getDataAdapter(),"\n"),r=r.concat("      Mode: "+u.getMode(),"\n");if(i&&(c=i.getLogger("smarthouse.quotestream"),c)){c.info(r);return}console.log(r)}function o(n){i=n;Lightstreamer.LightstreamerClient.setLoggerProvider(n)}function s(n){t=new f(n)}function h(){return t}var t,i,r,f,u;n.version="3.0.1";t=null;i=null;n.logStatus=e;n.setLoggerProvider=o;n.initClient=s;n.getClient=h;r=function(){function n(n,t,i){this._grid=n;this._subscription=t;this._fields=i}return n.prototype.isFieldSubscribed=function(n){return this._fields.indexOf(n)!=-1},n.prototype.getOldValue=function(n,t){return this._grid.getValue(n,t)},n.prototype.updateValue=function(n,t,i){var r={};r[t]=i;this._grid.updateRow(n,r)},n.prototype.getGrid=function(){return this._grid},n.prototype.getSubscription=function(){return this._subscription},n}();n.ValueHolder=r;f=function(){function n(n){this._options=n;this._lightstreamerClient=new Lightstreamer.LightstreamerClient(n.url,n.feedAdapter||"MDS5");this._lightstreamerClient.connectionDetails.setUser(n.user);this._lightstreamerClient.connectionDetails.setPassword(n.token);this._lightstreamerClient.connectionSharing.enableSharing("X"+this.getHashCode("QS_"+n.url+"_"+n.user+"_"+n.token+"_"+this._lightstreamerClient.connectionDetails.getAdapterSet()).toString().replace("-","N"),"ATTACH","CREATE",!0)}return n.prototype.getOptions=function(){return this._options},n.prototype.getHashCode=function(n){return n.split("").reduce(function(n,t){return n=(n<<5)-n+t.charCodeAt(0),n&n},0)},n.prototype.connect=function(){this._lightstreamerClient.connect()},n.prototype.disconnect=function(){this._lightstreamerClient.disconnect()},n.prototype.getLightstreamerClient=function(){return this._lightstreamerClient},n.prototype.initStaticGrid=function(n,t){var i,f,e;if(t===void 0&&(t={}),i=new Lightstreamer.StaticGrid(n,!0),f=i.extractFieldList(),t.additionalFieldsToSubscribe)for(e=0;e<t.additionalFieldsToSubscribe.length;e++)f.push(t.additionalFieldsToSubscribe[e]);var o=new Lightstreamer.Subscription("MERGE",this.removePrivateFields(i.extractItemList()),this.removePrivateFields(f)),s=new r(i,o,f),h=t.gridListener||new u;return i.addListener({onVisualUpdate:function(n,t){h.onUpdate(n,t,s)}}),this.initAbstractGrid(i,o,t),o.addListener(i),this._lightstreamerClient.subscribe(o),i},n.prototype.initSortedGrid=function(n,t){var i,f,o,r,u,e;if(t===void 0&&(t={}),i=new Lightstreamer.DynaGrid(n,!0),f=[],t.initialValues)for(o in t.initialValues)f.push(o);if(r=i.extractFieldList(),t.additionalFieldsToSubscribe)for(u=0;u<t.additionalFieldsToSubscribe.length;u++)r.push(t.additionalFieldsToSubscribe[u]);return e=new Lightstreamer.Subscription("MERGE",this.removePrivateFields(f),this.removePrivateFields(r)),i.sorting_originalItemUpdate=i.onItemUpdate,i.onItemUpdate=function(n){var t,i;this.sorting_originalItemUpdate(n);t=this.getSortField();t&&(i=!1,n.forEachChangedField(function(n){n!=t&&(i=!0)}),i&&this.setSort(t,this.isDescendingSort(),this.isNumericSort(),this.isCommaAsDecimalSeparator()))},this.initDynaGrid(i,e,t,r),this._lightstreamerClient.subscribe(e),i},n.prototype.initScrollGrid=function(n,t){var i=new Lightstreamer.DynaGrid(n,!0),r,u,e,f;if(i.forceSubscriptionInterpretation("UPDATE_IS_KEY"),r=i.extractFieldList(),t.additionalFieldsToSubscribe)for(u=0;u<t.additionalFieldsToSubscribe.length;u++)r.push(t.additionalFieldsToSubscribe[u]);return e=document.getElementById(n).getAttribute("data-item").split(","),f=new Lightstreamer.Subscription("MERGE",this.removePrivateFields(e),this.removePrivateFields(r)),this.initDynaGrid(i,f,t,r),this._lightstreamerClient.subscribe(f),i},n.prototype.initAbstractGrid=function(n,t,i){var r,u,f,e;if(i.addNewRowsOnTop&&n.setAddOnTop(i.addNewRowsOnTop),i.sortField&&n.setSort(i.sortField,i.isDescendingSorted,i.isNumericSort),r=!1,i.cleanOnFirstSubscribe&&(r=!0),u=!1,i.cleanOnLastUnsubscribe&&(u=!0),n.setAutoCleanBehavior(r,u),i.initialValues)for(f in i.initialValues)e=i.initialValues[f],n.updateRow(f,e);i.ignoreQuotetimeOnlyUpdates&&(n.ignoreQuotetimeOnlyUpdates_originalItemUpdate=n.onItemUpdate,n.onItemUpdate=function(n){var t=!1;n.forEachChangedField(function(n){n!="quotetime"&&(t=!0)});t&&this.ignoreQuotetimeOnlyUpdates_originalItemUpdate(n)});t.setDataAdapter(i.dataAdapter?i.dataAdapter:"MDS5");t.setRequestedSnapshot(i.requestSnapshot?"yes":"no")},n.prototype.initDynaGrid=function(n,t,i,f){i.maxRows?i.maxRows>0&&n.setMaxDynaRows(i.maxRows):n.setMaxDynaRows(5);var e=new r(n,t,f),o=i.gridListener||new u;n.addListener({onVisualUpdate:function(n,t){o.onUpdate(n,t,e)}});this.initAbstractGrid(n,t,i);t.addListener(n)},n.prototype.stopGrid=function(n){for(var t,u,i,f=this._lightstreamerClient.getSubscriptions(),r=0;r<f.length;r++)for(t=f[r],u=t.getListeners(),i=0;i<u.length;i++)if(u[i]===n){t.removeListener(n);this._lightstreamerClient.unsubscribe(t);return}},n.prototype.stopSubscription=function(n){this._lightstreamerClient.unsubscribe(n)},n.prototype.createSubscription=function(n,t,i,r){r===void 0&&(r="MDS5");var u=new Lightstreamer.Subscription("MERGE",n,t);return u.setDataAdapter(r),u.setRequestedSnapshot("no"),u.addListener({onItemUpdate:function(n){i(n)}}),this._lightstreamerClient.subscribe(u),u},n.prototype.removePrivateFields=function(n){return n.filter(function(n){return n[0]!="_"})},n}();n.QuoteStreamClient=f;u=function(){function n(n){this._upColor="#00dd00";this._downColor="#ee0000";this._pushColor="#eeee00";this._fadeInTime=0;this._fadeOutTime=300;this._flashTime=500;this._numberFormat="0,0.00";this._dateTimeFormat="LTS";this._columnFormats={};n&&(n.upColor&&(this._upColor=n.upColor),n.downColor&&(this._downColor=n.downColor),n.pushColor&&(this._pushColor=n.pushColor),n.fadeInTime&&(this._fadeInTime=n.fadeInTime),n.fadeOutTime&&(this._fadeOutTime=n.fadeOutTime),n.flashTime&&(this._flashTime=n.flashTime),n.numberFormat&&(this._numberFormat=n.numberFormat),n.dateTimeFormat&&(this._dateTimeFormat=n.dateTimeFormat),n.columnFormats&&(this._columnFormats=n.columnFormats))}return n.prototype.setUpColor=function(n){this._upColor=n},n.prototype.getUpColor=function(){return this._upColor},n.prototype.setDownColor=function(n){this._downColor=n},n.prototype.getDownColor=function(){return this._downColor},n.prototype.setPushColor=function(n){this._pushColor=n},n.prototype.getPushColor=function(){return this._pushColor},n.prototype.setFadeInTime=function(n){this._fadeInTime=n},n.prototype.getFadeInTime=function(){return this._fadeInTime},n.prototype.setFadeOutTime=function(n){this._fadeOutTime=n},n.prototype.getFadeOutTime=function(){return this._fadeOutTime},n.prototype.setFlashTime=function(n){this._flashTime=n},n.prototype.getFlashTime=function(){return this._flashTime},n.prototype.setNumberFormat=function(n){this._numberFormat=n},n.prototype.getNumberFormat=function(){return this._numberFormat},n.prototype.setDateTimeFormat=function(n){this._dateTimeFormat=n},n.prototype.getDateTimeFormat=function(){return this._dateTimeFormat},n.prototype.setColumnFormats=function(n){this._columnFormats=n},n.prototype.getColumnFormats=function(){return this._columnFormats},n.prototype.onUpdate=function(n,t,i){if(t!=null){var r=this;t.forEachChangedField(function(u,f){r.onFieldUpdate(n,t,u,f,i)});t.setColdToHotTime(this._fadeInTime);t.setHotToColdTime(this._fadeOutTime);t.setHotTime(this._flashTime)}},n.prototype.onFieldUpdate=function(n,t,i,r,u){var f,e,o;t.setCellValue(i,this.formatField(n,t,i,r,u));f=u.getOldValue(n,i);this.isFloat(r)&&this.isFloat(f)?(e=parseFloat(f),o=parseFloat(r),e>o?t.setCellAttribute(i,this._downColor,"transparent","backgroundColor"):e<o&&t.setCellAttribute(i,this._upColor,"transparent","backgroundColor")):r&&t.setCellAttribute(i,this._pushColor,"transparent","backgroundColor")},n.prototype.formatField=function(n,t,i,r,u){var f=this.getColumnFormat(n,t,i,r,u);return this.endsWith(i,"timestamp")||i=="arrival"||this.endsWith(i,"time")||this.endsWith(i,"date")?this.formatDateTime(n,i,r,f?f:this._dateTimeFormat):this.formatNumber(n,i,r,f?f:this._numberFormat)},n.prototype.formatDateTime=function(n,t,i,r){return typeof moment!="undefined"&&i?moment(i,["DD/MM/YYYY HH:mm:ss","HH:mm:ss","DD/MM/YYYY"]).format(r):i},n.prototype.formatNumber=function(n,t,i,r){return typeof numbro!="undefined"&&i&&this.isFloat(i)?numbro(parseFloat(i)).format(r):i},n.prototype.getColumnFormat=function(n,t,i){return this._columnFormats?this._columnFormats[i]:null},n.prototype.endsWith=function(n,t){return n.indexOf(t,n.length-t.length)!==-1},n.prototype.isFloat=function(n){return/^-?\d+\.?\d*?$/.test(n)},n.prototype.onPagesChange=function(){},n}();n.DefaultGridListener=u})(t=n.QuoteStream||(n.QuoteStream={}))})(Smarthouse||(Smarthouse={}))